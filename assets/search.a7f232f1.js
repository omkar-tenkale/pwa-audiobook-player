import{O as r,Q as e,R as t,W as n,d as i,u as a,X as o,c as l,Y as s,i as f,h as u,p as c,b as v,A as h,t as d,Z as w,$ as b,a as g,y as p,f as m,a0 as y,F as k,J as S,q as x,e as _,M as C,a1 as M,x as q,N as A}from"./index.6cc77cfb.js";var T,j,F,I="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},$={exports:{}};j=I,F=r=>{var e=r=>{"number"==typeof r?r=""+r:"string"!=typeof r&&(r="");var e=h(r);return i(r,{t:e.i,o:e.lowerCodes,l:e.bitflags})};class t{get indexes(){return this.u.slice(0,this.u.len).sort(((r,e)=>r-e))}set indexes(r){return this.u=r}highlight(r,e){return((r,e="<b>",t="</b>")=>{for(var n="function"==typeof e?e:void 0,i=r.target,a=i.length,o=r.indexes,l="",s=0,f=0,u=!1,c=[],v=0;v<a;++v){var h=i[v];if(o[f]===v){if(++f,u||(u=!0,n?(c.push(l),l=""):l+=e),f===o.length){n?(l+=h,c.push(n(l,s++)),l="",c.push(i.substr(v+1))):l+=h+t+i.substr(v+1);break}}else u&&(u=!1,n?(c.push(n(l,s++)),l=""):l+=t);l+=h}return n?c:l})(this,r,e)}get score(){return a(this.v)}set score(r){this.v=o(r)}}class n extends Array{get score(){return a(this.v)}set score(r){this.v=o(r)}}var i=(r,e)=>{var n,i,a,o,l,s,f;const u=new t;return u.target=r,u.obj=null!=(n=e.obj)?n:$,u.v=null!=(i=e.v)?i:q,u.u=null!=(a=e.u)?a:[],u.t=null!=(o=e.t)?o:"",u.o=null!=(l=e.o)?l:$,u.h=null!=(s=e.h)?s:$,u.l=null!=(f=e.l)?f:0,u},a=r=>r===q?0:r>1?r:Math.E**(-2*((1-r)**.04307-1)),o=r=>0===r?q:r>1?r:1-Math.pow(Math.log(r)/-2+1,1/.04307),l=r=>{"number"==typeof r?r=""+r:"string"!=typeof r&&(r=""),r=r.trim();var e=h(r),t=[];if(e.containsSpace){var n=r.split(/\s+/);n=[...new Set(n)];for(var i=0;i<n.length;i++)if(""!==n[i]){var a=h(n[i]);t.push({lowerCodes:a.lowerCodes,i:n[i].toLowerCase(),containsSpace:!1})}}return{lowerCodes:e.lowerCodes,i:e.i,containsSpace:e.containsSpace,bitflags:e.bitflags,spaceSearches:t}},s=r=>{if(r.length>999)return e(r);var t=w.get(r);return void 0!==t||(t=e(r),w.set(r,t)),t},f=r=>{if(r.length>999)return l(r);var e=b.get(r);return void 0!==e||(e=l(r),b.set(r,e)),e},u=(r,e,n=!1,i=!1)=>{if(!1===n&&r.containsSpace)return c(r,e,i);for(var a=r.i,o=r.lowerCodes,l=o[0],s=e.o,f=o.length,u=s.length,v=0,h=0,w=0;;){if(l===s[h]){if(g[w++]=h,++v===f)break;l=o[v]}if(++h>=u)return $}v=0;var b=!1,m=0,y=e.h;y===$&&(y=e.h=d(e.target));var k=0;if((h=0===g[0]?0:y[g[0]-1])!==u)for(;;)if(h>=u){if(v<=0)break;if(++k>200)break;--v;var S=p[--m];h=y[S]}else if(o[v]===s[h]){if(p[m++]=h,++v===f){b=!0;break}++h}else h=y[h];var x=f<=1?-1:e.t.indexOf(a,g[0]),_=!!~x,C=!!_&&(0===x||e.h[x-1]===x);if(_&&!C)for(var M=0;M<y.length;M=y[M])if(!(M<=x)){for(var q=0;q<f&&o[q]===e.o[M+q];q++);if(q===f){x=M,C=!0;break}}var A=r=>{for(var e=0,t=0,n=1;n<f;++n)r[n]-r[n-1]!=1&&(e-=r[n],++t);if(e-=(r[f-1]-r[0]-(f-1)+12)*t,0!==r[0]&&(e-=r[0]*r[0]*.2),b){var i=1;for(n=y[0];n<u;n=y[n])++i;i>24&&(e*=10*(i-24))}else e*=1e3;return e-=(u-f)/2,_&&(e/=1+f*f*1),C&&(e/=1+f*f*1),e-(u-f)/2};if(b)if(C){for(M=0;M<f;++M)g[M]=x+M;T=g,j=A(g)}else T=p,j=A(p);else{if(_)for(M=0;M<f;++M)g[M]=x+M;var T,j=A(T=g)}for(e.v=j,M=0;M<f;++M)e.u[M]=T[M];e.u.len=f;const F=new t;return F.target=e.target,F.v=e.v,F.u=e.u,F},c=(r,e,t)=>{for(var n=new Set,i=0,a=$,o=0,l=r.spaceSearches,s=l.length,f=0,c=()=>{for(let r=f-1;r>=0;r--)e.h[m[2*r+0]]=m[2*r+1]},v=!1,h=0;h<s;++h){k[h]=q;var d=l[h];if(a=u(d,e),t){if(a===$)continue;v=!0}else if(a===$)return c(),$;if(h!==s-1){var w=a.u,b=!0;for(let r=0;r<w.len-1;r++)if(w[r+1]-w[r]!=1){b=!1;break}if(b){var g=w[w.len-1]+1,p=e.h[g-1];for(let r=g-1;r>=0&&p===e.h[r];r--)e.h[r]=g,m[2*f+0]=r,m[2*f+1]=p,f++}}i+=a.v/s,k[h]=a.v/s,a.u[0]<o&&(i-=2*(o-a.u[0])),o=a.u[0];for(var y=0;y<a.u.len;++y)n.add(a.u[y])}if(t&&!v)return $;c();var S=u(r,e,!0);if(S!==$&&S.v>i){if(t)for(h=0;h<s;++h)k[h]=S.v/s;return S}t&&(a=e),a.v=i,h=0;for(let u of n)a.u[h++]=u;return a.u.len=h,a},v=r=>r.replace(/\p{Script=Latin}+/gu,(r=>r.normalize("NFD"))).replace(/[\u0300-\u036f]/g,""),h=r=>{for(var e=(r=v(r)).length,t=r.toLowerCase(),n=[],i=0,a=!1,o=0;o<e;++o){var l=n[o]=t.charCodeAt(o);32!==l?i|=1<<(l>=97&&l<=122?l-97:l>=48&&l<=57?26:l<=127?30:31):a=!0}return{lowerCodes:n,bitflags:i,containsSpace:a,i:t}},d=r=>{for(var e=(r=v(r)).length,t=(r=>{for(var e=r.length,t=[],n=0,i=!1,a=!1,o=0;o<e;++o){var l=r.charCodeAt(o),s=l>=65&&l<=90,f=s||l>=97&&l<=122||l>=48&&l<=57,u=s&&!i||!a||!f;i=s,a=f,u&&(t[n++]=o)}return t})(r),n=[],i=t[0],a=0,o=0;o<e;++o)i>o?n[o]=i:(i=t[++a],n[o]=void 0===i?e:i);return n},w=new Map,b=new Map,g=[],p=[],m=[],y=[],k=[],S=[],x=[],_=(r,e)=>{var t=r[e];if(void 0!==t)return t;if("function"==typeof e)return e(r);var n=e;Array.isArray(e)||(n=e.split("."));for(var i=n.length,a=-1;r&&++a<i;)r=r[n[a]];return r},C=r=>"object"==typeof r&&"number"==typeof r.l,M=1/0,q=-1/0,A=[];A.total=0;var T,j,F,I,$=null,L=e(""),N=(T=[],j=0,I=r=>{for(var e=0,t=T[e],n=1;n<j;){var i=n+1;e=n,i<j&&T[i].v<T[n].v&&(e=i),T[e-1>>1]=T[e],n=1+(e<<1)}for(var a=e-1>>1;e>0&&t.v<T[a].v;a=(e=a)-1>>1)T[e]=T[a];T[e]=t},(F={}).add=r=>{var e=j;T[j++]=r;for(var t=e-1>>1;e>0&&r.v<T[t].v;t=(e=t)-1>>1)T[e]=T[t];T[e]=r},F.poll=r=>{if(0!==j){var e=T[0];return T[0]=T[--j],I(),e}},F.peek=r=>{if(0!==j)return T[0]},F.replaceTop=r=>{T[0]=r,I()},F);return{single:(r,e)=>{if(!r||!e)return $;var t=f(r);C(e)||(e=s(e));var n=t.bitflags;return(n&e.l)!==n?$:u(t,e)},go:(r,e,t)=>{if(!r)return(null==t?void 0:t.all)?((r,e)=>{var t=[];t.total=r.length;var a=(null==e?void 0:e.limit)||M;if(null==e?void 0:e.key)for(var o=0;o<r.length;o++){var l=r[o];if((v=_(l,e.key))!=$){C(v)||(v=s(v));var f=i(v.target,{v:v.v,obj:l});if(t.push(f),t.length>=a)return t}}else if(null==e?void 0:e.keys)for(o=0;o<r.length;o++){l=r[o];for(var u=new n(e.keys.length),c=e.keys.length-1;c>=0;--c)(v=_(l,e.keys[c]))?(C(v)||(v=s(v)),v.v=q,v.u.len=0,u[c]=v):u[c]=L;if(u.obj=l,u.v=q,t.push(u),t.length>=a)return t}else for(o=0;o<r.length;o++){var v;if((v=r[o])!=$&&(C(v)||(v=s(v)),v.v=q,v.u.len=0,t.push(v),t.length>=a))return t}return t})(e,t):A;var a=f(r),l=a.bitflags,c=a.containsSpace,v=o((null==t?void 0:t.threshold)||0),h=(null==t?void 0:t.limit)||M,d=0,w=0,b=e.length;function g(r){d<h?(N.add(r),++d):(++w,r.v>N.peek().v&&N.replaceTop(r))}if(null==t?void 0:t.key)for(var p=t.key,m=0;m<b;++m){var T=e[m];(B=_(T,p))&&(C(B)||(B=s(B)),(l&B.l)===l&&(D=u(a,B))!==$&&(D.v<v||(D.obj=T,g(D))))}else if(null==t?void 0:t.keys){var j=t.keys,F=j.length;r:for(m=0;m<b;++m){T=e[m];for(var I=0,R=0;R<F;++R)p=j[R],(B=_(T,p))?(C(B)||(B=s(B)),S[R]=B,I|=B.l):S[R]=L;if((l&I)===l){if(c)for(let r=0;r<a.spaceSearches.length;r++)y[r]=q;for(R=0;R<F;++R)if((B=S[R])!==L)if(x[R]=u(a,B,!1,c),x[R]!==$){if(c)for(let r=0;r<a.spaceSearches.length;r++)k[r]>-1e3&&y[r]>q&&(z=(y[r]+k[r])/4)>y[r]&&(y[r]=z),k[r]>y[r]&&(y[r]=k[r])}else x[R]=L;else x[R]=L;if(c){for(let r=0;r<a.spaceSearches.length;r++)if(y[r]===q)continue r}else{var O=!1;for(let r=0;r<F;r++)if(x[r].v!==q){O=!0;break}if(!O)continue}var U=new n(F);for(let r=0;r<F;r++)U[r]=x[r];if(c){var W=0;for(let r=0;r<a.spaceSearches.length;r++)W+=y[r]}else{W=q;for(let r=0;r<F;r++){var z;(D=U[r]).v>-1e3&&W>q&&(z=(W+D.v)/4)>W&&(W=z),D.v>W&&(W=D.v)}}if(U.obj=T,U.v=W,null==t?void 0:t.scoreFn){if(!(W=t.scoreFn(U)))continue;W=o(W),U.v=W}W<v||g(U)}}}else for(m=0;m<b;++m){var B,D;(B=e[m])&&(C(B)||(B=s(B)),(l&B.l)===l&&(D=u(a,B))!==$&&(D.v<v||g(D)))}if(0===d)return A;var E=new Array(d);for(m=d-1;m>=0;--m)E[m]=N.poll();return E.total=d+w,E},prepare:e,cleanup:()=>{w.clear(),b.clear()}}},(T=$).exports?T.exports=F():j.fuzzysort=F();const L=r=>{const e=[{target:r.name,key:"name"},{target:r.artists.join(" "),key:"artists"}];return r.album&&e.push({target:r.album,key:"album"}),r.description&&e.push({target:r.description,key:"description"}),r.topics&&e.push({target:r.topics.join(" "),key:"topics"}),e},N=(r,e)=>((r,e)=>{const t=((r,e,t={})=>{const{threshold:n=-1e3,limit:i=100,all:a=!1}=t;return r.trim()||a?!r.trim()&&a?e.map((r=>({item:r,score:0}))):$.exports.go(r,e,{key:"name",threshold:n,limit:i,all:a}).map((r=>({item:r.obj,score:r.score,highlighted:{name:r.highlight("<b>","</b>")}}))):[]})(r,e,{threshold:-500});return t.map((r=>r.item))})(r,e),R=[{...r,filter:(r,e)=>((r,e)=>{const t=((r,e,t={})=>{const{threshold:n=-1e3,limit:i=100,all:a=!1}=t;if(!r.trim()&&!a)return[];if(!r.trim()&&a)return e.map((r=>({item:r,score:0})));const o=e.map((r=>({track:r,targets:L(r)}))),l=[];o.forEach((({track:e,targets:t})=>{t.forEach((({target:t,key:i})=>{const a=$.exports.single(r,t);a&&a.score>=n&&l.push({track:e,result:a,score:a.score,matchedField:i})}))}));const s=new Map;return l.forEach((r=>{const e=s.get(r.track.id);(!e||r.score>e.score)&&s.set(r.track.id,r)})),Array.from(s.values()).sort(((r,e)=>e.score-r.score)).slice(0,i).map((({track:r,score:e,result:t,matchedField:n})=>({item:r,score:e,highlighted:{[n]:t.highlight?t.highlight("<b>","</b>"):void 0}})))})(r,e,{threshold:-500});return t.map((r=>r.item))})(r,e)},{...e,filter:N},{...t,filter:N},{...n,filter:N}],O=d('<div><input aria-label="Search box" placeholder="Search..." autocapitalize="none"></div>',3),U=d("<div></div>",2),W=r=>{const e=a();let t;const n=r=>{e(`/search/${encodeURIComponent(r)}`,{replace:!0})},i=w((()=>{const r=t.value.trim();n(r)}),200),d=()=>{n("")};return o((()=>{if(!t)return;const e=r.searchTerm;b(t)&&""!==e||(t.value=e)})),l(h,{hideSpacer:!0,get children(){return[(()=>{const e=O.cloneNode(!0),n=e.firstChild;return"function"==typeof t?t(n):t=n,s(n,"input",i,!0),f(e,(()=>{const e=u((()=>!!r.searchTerm),!0);return()=>e()&&l(c,{icon:"close",onClick:d})})(),null),v((r=>{const t="i cd",i="wa F Q -a dd";return t!==r.g&&(e.className=r.g=t),i!==r.p&&(n.className=r.p=i),r}),{g:void 0,p:void 0}),e})(),(()=>{const r=U.cloneNode(!0);return v((()=>r.className="ed")),r})()]}})};i(["input"]);const z=d("<div></div>",2),B=d("<button></button>",2),D=d("<h1></h1>",2),E="/search/:searchTerm",J=()=>{const[r]=g(),e=p((()=>"/search/:searchTerm/*")),t=u((()=>{var r;return decodeURIComponent((null==(r=e())?void 0:r.params.searchTerm)||"")})),n=R.map((e=>{const[n,i]=m(!0),a=u(((i=[])=>{const a=Object.values((e=>{switch(e){case A.TRACK:return r.tracks;case A.ARTIST:return r.artists;case A.ALBUM:return r.albums;case A.PLAYLIST:return r.playlists;default:throw new Error("Wrong type")}})(e.type)),o=n(),l=t().trim();return y((()=>{if(""===l)return a.map((r=>r.id));if(!o)return i;const r=(r=>r.sort(((r,e)=>{const t=r.name.toLowerCase().trim(),n=e.name.toLowerCase().trim();return t<n?-1:t>n?1:0})))(e.filter(l,a));return r.map((r=>r.id))}))}));return{...e,itemIds:a,isSelected:n,setIsSelected:i}})),i=u((()=>n.some((r=>0!==r.itemIds().length))));return l(q,{get topBar(){return l(W,{get searchTerm(){return t()}})},title:"Search",scrollable:!0,get children(){return[(()=>{const r=z.cloneNode(!0);return f(r,l(k,{each:n,children:r=>(()=>{const e=B.cloneNode(!0);return e.$$click=()=>r.setIsSelected((r=>!r)),f(e,l(S,{icon:"checkmark",get class(){return"jd"}}),null),f(e,(()=>r.title),null),v((()=>e.className=x("na -B -J -F F Q -a -u -p -S da y hd",r.isSelected()&&"id"))),e})()})),v((()=>r.className="ka -q -u gd")),r})(),l(_,{get when(){return i()},get fallback(){return l(C,{message:"Nothing found"})},get children(){return l(k,{each:n,children:r=>l(_,{get when(){return u((()=>!!r.itemIds().length),!0)()&&r.isSelected()},get children(){return[(()=>{const e=D.cloneNode(!0);return f(e,(()=>r.title)),v((()=>e.className="D O Z -j -q kd")),e})(),l(M,{get component(){return r.component},get items(){return r.itemIds()}})]}})})}})]}})};i(["click"]);export{E as SEARCH_MAIN_PATH,J as default};
